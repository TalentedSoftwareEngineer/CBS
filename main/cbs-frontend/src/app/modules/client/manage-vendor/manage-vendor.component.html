<h4 class="page_title">Manage Vendor</h4>
<div class="card">
    <div class="grid">
      <div class="col-12 md:col-5">
        <div class="p-inputgroup">
          <input type="text" pInputText placeholder="Keyword..." [(ngModel)]="filterValue" [disabled]="isLoading" (keyup.enter)="onClickFilter()">
          <button type="button" pButton pRipple label="Search" icon="pi pi-search" (click)="isLoading ? '' : onClickFilter()" [style]="isLoading ? {opacity: 0.5} : ''"></button>
        </div>
      </div>

      <div class="col-12 md:col-7 text-right" *ngIf="write_permission">
        <button pButton pRipple label="Add New Vendor" (click)="openModal('Add')" icon="pi pi-plus"></button>
      </div>
    </div>
</div>

<div class="card">
  <h5><span *ngIf="resultsLength!=-1">Total {{resultsLength}} Record</span><span *ngIf="resultsLength>1">s</span><i *ngIf="resultsLength!=-1&&filterResultLength!=-1&&filterResultLength<resultsLength" style="font-size: medium;">, {{filterResultLength}} Record<span *ngIf="filterResultLength>1">s</span> Filtered</i></h5>
  <p-table [value]="vendors" responsiveLayout="stack" [responsive]="true">
    <ng-template pTemplate="header">
      <tr>
        <th class="text-align-center" [ngClass]="sortActive === 'company_id' ? 'sorting_' + sortDirection.toLowerCase() :'sorting'">
          <a (click)="onSortChange('company_id')">Company ID</a>
        </th>
        <th class="text-align-center" [ngClass]="sortActive === 'company_name' ? 'sorting_' + sortDirection.toLowerCase() :'sorting'">
          <a (click)="onSortChange('company_name')">Company Name</a>
        </th>
        <th class="text-align-center" [ngClass]="sortActive === 'first_name' ? 'sorting_' + sortDirection.toLowerCase() :'sorting'">
          <a (click)="onSortChange('first_name')">First Name</a>
        </th>
        <th class="text-align-center" [ngClass]="sortActive === 'last_name' ? 'sorting_' + sortDirection.toLowerCase() :'sorting'">
            <a (click)="onSortChange('last_name')">Last Name</a>
        </th>
        <th class="text-align-center" [ngClass]="sortActive === 'email' ? 'sorting_' + sortDirection.toLowerCase() :'sorting'">
            <a (click)="onSortChange('email')">Email</a>
        </th>
        <th class="text-align-center" [ngClass]="sortActive === 'created_at' ? 'sorting_' + sortDirection.toLowerCase() :'sorting'">
          <a (click)="onSortChange('created_at')">Created At</a>
        </th>
        <th class="text-align-center" [ngClass]="sortActive === 'updated_at' ? 'sorting_' + sortDirection.toLowerCase() :'sorting'">
          <a (click)="onSortChange('updated_at')">Updated At</a>
        </th>
        <th class="text-align-center" [ngClass]="sortActive === 'created_by' ? 'sorting_' + sortDirection.toLowerCase() :'sorting'">
          <a (click)="onSortChange('created_by')">Created By</a>
        </th>
        <th class="text-align-center" [ngClass]="sortActive === 'updated_by' ? 'sorting_' + sortDirection.toLowerCase() :'sorting'">
          <a (click)="onSortChange('updated_by')">Updated By</a>
        </th>

        <th class="text-align-center w-100px" *ngIf="write_permission">Action</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-vendor>
      <tr>
        <td class="text-align-center">
          <span class="p-column-title">Company ID</span>
          {{ vendor.company_id}}
        </td>
        <td class="text-align-center">
          <span class="p-column-title">Company Name</span>
          {{ vendor.company_name }}
        </td>
        <td class="text-align-center">
          <span class="p-column-title">First Name</span>
          {{ vendor.first_name }}
        </td>
        <td class="text-align-center">
          <span class="p-column-title">Last Name</span>
          {{ vendor.last_name }}
        </td>
        <td class="text-align-center">
          <span class="p-column-title">Email</span>
          {{ vendor.email }}
        </td>
        <td class="text-align-center">
          <span class="p-column-title">Created At</span>
          {{ vendor.created_at }}
        </td>
        <td class="text-align-center">
          <span class="p-column-title">Updated At</span>
          {{ vendor.updated_at }}
        </td>
        <td class="text-align-center">
          <span class="p-column-title">Created By</span>
          {{ vendor.created?.username }}
        </td>
        <td class="text-align-center">
          <span class="p-column-title">Updated By</span>
          {{ vendor.updated?.username }}
        </td>

        <td class="text-align-center" *ngIf="write_permission">
          <span class="p-buttonset">
            <button pButton type="button" title="Edit" icon="pi pi-pencil" class="p-button-rounded p-button-outlined p-button-warning" (click)="onOpenEditModal($event, vendor.id)"></button>
            <button pButton type="button" title="Delete" icon="pi pi-trash" class="p-button-rounded p-button-outlined p-button-danger" (click)="delete($event, vendor.id)"></button>
          </span>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-paginator [rows]="pageSize" [totalRecords]="filterResultLength" [rowsPerPageOptions]="rowsPerPageOptions" (onPageChange)="paginate($event)"></p-paginator>
</div>

<p-dialog [header]="modalTitle + ' Vendor'" styleClass="c-modal" [(visible)]="flag_openDialog" (onHide)="closeModal()" [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '90vw'}" [modal]="true" [draggable]="false" [resizable]="false">
  <div class="card">
    <p-tabView [(activeIndex)]="tabIndex">
      <p-tabPanel header="General">
        <form [formGroup]="companyForm">
          <div class="grid p-fluid">
            <div class="md:col-6 col-12">
              <span class="p-float-label">
                <input type="text" class="form-control" id="company_name" formControlName="company_name" pInputText [(ngModel)]="inputCompanyName" class="{{isCompanyFormFieldValid('company_name') ? 'ng-invalid ng-dirty' : ''}}">
                <label for="company_name">Company Name</label>
              </span>
            </div>
            <div class="md:col-6 col-12">
              <span class="p-float-label">
                <input type="text" class="form-control" id="company_id" formControlName="company_id" pInputText [(ngModel)]="inputCompanyId" class="{{isCompanyFormFieldValid('company_id') ? 'ng-invalid ng-dirty' : ''}}">
                <label for="company_id">Company ID</label>
              </span>
            </div>
            <!-- <div class="md:col-6 col-12">
              <span class="p-float-label">
                <input type="text" class="form-control" id="vendor_name" formControlName="vendor_name" pInputText [(ngModel)]="inputVendorName" class="{{isCompanyFormFieldValid('vendor_name') ? 'ng-invalid ng-dirty' : ''}}">
                <label for="vendor_name">Vendor Name</label>
              </span>
            </div> -->
            <div class="md:col-6 col-12">
              <span class="p-float-label">
                <input type="text" class="form-control" id="first_name" formControlName="first_name" pInputText [(ngModel)]="inputFirstName" class="{{isCompanyFormFieldValid('first_name') ? 'ng-invalid ng-dirty' : ''}}">
                <label for="first_name">First Name</label>
              </span>
            </div>
            <div class="md:col-6 col-12">
              <span class="p-float-label">
                <input type="text" class="form-control" id="last_name" formControlName="last_name" pInputText [(ngModel)]="inputLastName" class="{{isCompanyFormFieldValid('last_name') ? 'ng-invalid ng-dirty' : ''}}">
                <label for="last_name">Last Name</label>
              </span>
            </div>
            <div class="md:col-6 col-12">
              <span class="p-float-label">
                <input type="text" class="form-control" id="email" formControlName="email" pInputText [(ngModel)]="inputEmail" class="{{isCompanyFormFieldValid('email') ? 'ng-invalid ng-dirty' : ''}}">
                <label for="email">Email</label>
              </span>
            </div>
            <div class="md:col-6 col-12">
              <span class="p-float-label">
                <p-dropdown [options]="statusOptions" formControlName="status" id="status" optionLabel="name" optionValue="value" scrollHeight="200px"></p-dropdown>
                <label>Status</label>
              </span>
            </div>
          </div>
        </form>
      </p-tabPanel>

      <p-tabPanel header="Billing">
        <form [formGroup]="billingForm">
          <div class="grid p-fluid">
            <div class="col-12 md:col-6">
              <span class="p-float-label">
                <p-dropdown [options]="billingMethodOptions" formControlName="method" id="method" optionLabel="name" optionValue="value" scrollHeight="150px"></p-dropdown>
                <label>Billing Method</label>
              </span>
            </div>
            <div class="col-12 md:col-6">
              <span class="p-float-label">
                <p-dropdown [options]="billingCycleOptions" formControlName="cycle" id="cycle" optionLabel="name" optionValue="value" [filter]="true" filterBy="name" scrollHeight="250px"></p-dropdown>
                <label>Billing Cycle</label>
              </span>
            </div>
            <div class="col-12 md:col-6">
              <span class="p-float-label">
                <p-calendar
                  dateFormat="mm/dd/yy"
                  [showButtonBar]="true"
                  formControlName="start"
                ></p-calendar>
                <label>Billing Start</label>
            </span>
            </div>
            <div class="col-12 md:col-6">
              <span class="p-float-label">
                <input type="text"  class="{{isBillingFormFieldValid('billing_email') ? 'form-control ng-invalid ng-dirty' : 'form-control'}}" id="billing_email" formControlName="billing_email" pInputText [(ngModel)]="inputBillingEmail">
                <label for="billing_email">Billing Email</label>
              </span>
            </div>
          </div>
        </form>
      </p-tabPanel>

      <p-tabPanel header="Rates">
        <form [formGroup]="ratesForm">
          <div class="grid p-fluid">
            <div class="col-12 md:col-6">
              <span class="p-float-label">
                <p-dropdown [options]="ratesTypeOptions" [(ngModel)]="selectRateType" (onChange)="onChangeRatesType($event)" formControlName="rate_type" id="rate_type" optionLabel="name" optionValue="value" scrollHeight="150px"></p-dropdown>
                <label>Rate Type</label>
              </span>
            </div>

            <ng-container *ngIf="selectRateType=='FIXED'">
                <div class="col-12 md:col-6 p-0"></div>
                <div class="col-12 md:col-6">
                    <span class="p-float-label">
                      <input type="text" class="form-control" id="flat_rate" formControlName="flat_rate" pInputText [(ngModel)]="inputFlatRate" class="{{isRatesFormFieldValid('flat_rate') ? 'ng-invalid ng-dirty' : ''}}">
                      <label for="flat_rate">Flat Rate</label>
                    </span>
                </div>
            </ng-container>

            <div class="col-12 md:col-6">
              <span class="p-float-label">
                <input type="text" class="form-control" id="default_rate" formControlName="default_rate" pInputText [(ngModel)]="inputDefaultRate" class="{{isRatesFormFieldValid('default_rate') ? 'ng-invalid ng-dirty' : ''}}">
                <label for="default_rate">Default Rate</label>
              </span>
            </div>
            <div class="col-12 md:col-6">
              <span class="p-float-label">
                <input type="text" class="form-control" id="inidur" formControlName="inidur" pInputText [(ngModel)]="inputInidur" class="{{isRatesFormFieldValid('inidur') ? 'ng-invalid ng-dirty' : ''}}">
                <label for="inidur">Init Duration</label>
              </span>
            </div>
            <div class="col-12 md:col-6">
              <span class="p-float-label">
                <input type="text" class="form-control" id="succdur" formControlName="succdur" pInputText [(ngModel)]="inputSuccdur" class="{{isRatesFormFieldValid('succdur') ? 'ng-invalid ng-dirty' : ''}}">
                <label for="succdur">Succ Duration</label>
              </span>
            </div>
          </div>
        </form>
      </p-tabPanel>
    </p-tabView>
    <div class="flex justify-content-end">
      <button pButton pRipple (click)="onSubmit()" label="Save" icon="pi pi-save" class="p-button-text"></button>
    </div>
  </div>
</p-dialog>
